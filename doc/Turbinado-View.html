<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span> <span class='layout'>(</span>
<a name="(line2)"></a>        <span class='varid'>evalView</span><span class='layout'>,</span>
<a name="(line3)"></a>        <span class='varid'>defaultContentType</span><span class='layout'>,</span>
<a name="(line4)"></a>        <span class='comment'>-- limited export from Turbinado.View.Monad</span>
<a name="(line5)"></a>        <span class='conid'>View</span><span class='layout'>,</span>
<a name="(line6)"></a>        <span class='varid'>runView</span><span class='layout'>,</span>
<a name="(line7)"></a>        <span class='comment'>-- * Functions</span>
<a name="(line8)"></a>        <span class='varid'>liftIO</span><span class='layout'>,</span> <span class='varid'>catch</span><span class='layout'>,</span>
<a name="(line9)"></a>        <span class='varid'>insertView</span><span class='layout'>,</span>
<a name="(line10)"></a>        <span class='varid'>insertDefaultView</span><span class='layout'>,</span>
<a name="(line11)"></a>        <span class='varid'>insertComponent</span><span class='layout'>,</span>
<a name="(line12)"></a>        <span class='varid'>prettyHtml</span><span class='layout'>,</span>
<a name="(line13)"></a>
<a name="(line14)"></a>        <span class='comment'>-- Module Exports</span>
<a name="(line15)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>Helpers</span><span class='layout'>,</span>
<a name="(line16)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>HTML</span><span class='layout'>,</span>
<a name="(line17)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>CodeStore</span><span class='layout'>,</span>
<a name="(line18)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Params</span><span class='layout'>,</span>
<a name="(line19)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Request</span><span class='layout'>,</span>
<a name="(line20)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Response</span><span class='layout'>,</span>
<a name="(line21)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Settings</span><span class='layout'>,</span>
<a name="(line22)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span><span class='layout'>,</span>
<a name="(line23)"></a>        <span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>ViewData</span>
<a name="(line24)"></a>        <span class='layout'>)</span> <span class='keyword'>where</span>
<a name="(line25)"></a>
<a name="(line26)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>OldException</span> <span class='layout'>(</span><span class='varid'>catchDyn</span><span class='layout'>)</span>
<a name="(line27)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span>
<a name="(line28)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span><span class='varop'>.</span><span class='conid'>State</span>
<a name="(line29)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span><span class='varop'>.</span><span class='conid'>Trans</span> <span class='layout'>(</span><span class='conid'>MonadIO</span><span class='layout'>(</span><span class='keyglyph'>..</span><span class='layout'>)</span><span class='layout'>)</span>
<a name="(line30)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Char</span>
<a name="(line31)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>List</span>
<a name="(line32)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Maybe</span>
<a name="(line33)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>HTTP</span> <span class='keyword'>as</span> <span class='conid'>HTTP</span>
<a name="(line34)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>URI</span>  <span class='keyword'>as</span> <span class='conid'>URI</span>
<a name="(line35)"></a><span class='keyword'>import</span> <span class='conid'>Prelude</span> <span class='varid'>hiding</span> <span class='layout'>(</span><span class='varid'>catch</span><span class='layout'>)</span>
<a name="(line36)"></a><span class='keyword'>import</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>FilePath</span>
<a name="(line37)"></a><span class='keyword'>import</span> <span class='conid'>Text</span><span class='varop'>.</span><span class='conid'>XHtml</span><span class='varop'>.</span><span class='conid'>Strict</span>
<a name="(line38)"></a>
<a name="(line39)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Controller</span><span class='varop'>.</span><span class='conid'>Monad</span> <span class='varid'>hiding</span> <span class='layout'>(</span><span class='varid'>catch</span><span class='layout'>)</span>
<a name="(line40)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>CodeStore</span>
<a name="(line41)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Logger</span>
<a name="(line42)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Params</span>
<a name="(line43)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Request</span>
<a name="(line44)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Response</span>
<a name="(line45)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Settings</span>
<a name="(line46)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span>
<a name="(line47)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>ViewData</span>
<a name="(line48)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Server</span><span class='varop'>.</span><span class='conid'>StandardResponse</span>
<a name="(line49)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>Exception</span>
<a name="(line50)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>Helpers</span>
<a name="(line51)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>HTML</span>
<a name="(line52)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>View</span><span class='varop'>.</span><span class='conid'>Monad</span> <span class='varid'>hiding</span> <span class='layout'>(</span><span class='varid'>liftIO</span><span class='layout'>)</span>
<a name="(line53)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Utility</span><span class='varop'>.</span><span class='conid'>Data</span>
<a name="(line54)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Utility</span><span class='varop'>.</span><span class='conid'>Naming</span>
<a name="(line55)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Master</span> <span class='keyword'>as</span> <span class='conid'>Config</span>
<a name="(line56)"></a>
<a name="(line57)"></a><a name="evalView"></a><span class='varid'>evalView</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>VHtml</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line58)"></a><span class='varid'>evalView</span> <span class='varid'>p</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line59)"></a>                <span class='layout'>(</span><span class='varid'>x</span><span class='layout'>,</span> <span class='varid'>e'</span><span class='layout'>)</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>runView</span> <span class='varid'>p</span> <span class='varid'>e</span>
<a name="(line60)"></a>                <span class='varid'>pageResponse</span> <span class='conid'>[]</span> <span class='varop'>$</span> <span class='varid'>prettyHtml</span> <span class='varid'>x</span>
<a name="(line61)"></a>
<a name="(line62)"></a><a name="defaultContentType"></a><span class='varid'>defaultContentType</span> <span class='keyglyph'>::</span> <span class='conid'>String</span>
<a name="(line63)"></a><span class='varid'>defaultContentType</span> <span class='keyglyph'>=</span> <span class='str'>"text/html; charset=ISO-8859-1"</span>
<a name="(line64)"></a>
<a name="(line65)"></a><a name="insertDefaultView"></a><span class='varid'>insertDefaultView</span> <span class='keyglyph'>::</span> <span class='conid'>VHtml</span>
<a name="(line66)"></a><span class='varid'>insertDefaultView</span> <span class='keyglyph'>=</span> 
<a name="(line67)"></a>             <span class='keyword'>do</span> <span class='varid'>cl</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getView</span>
<a name="(line68)"></a>                <span class='varid'>debugM</span> <span class='varop'>$</span> <span class='str'>"    Layout: insertDefaultView : loading   "</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>fst</span> <span class='varid'>cl</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='str'>" - "</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>snd</span> <span class='varid'>cl</span><span class='layout'>)</span>
<a name="(line69)"></a>                <span class='varid'>c</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>retrieveCode</span> <span class='conid'>CTView</span> <span class='varid'>cl</span>
<a name="(line70)"></a>                <span class='keyword'>case</span> <span class='varid'>c</span> <span class='keyword'>of</span>
<a name="(line71)"></a>                  <span class='conid'>CodeLoadView</span>       <span class='varid'>v</span> <span class='keyword'>_</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>v</span> 
<a name="(line72)"></a>                  <span class='conid'>CodeLoadController</span> <span class='keyword'>_</span> <span class='keyword'>_</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>error</span> <span class='str'>"retrieveAndRunLayout called, but returned CodeLoadController"</span>
<a name="(line73)"></a>                  <span class='conid'>CodeLoadFailure</span>    <span class='varid'>e</span>     <span class='keyglyph'>-&gt;</span> <span class='varid'>stringToVHtml</span> <span class='varid'>e</span>
<a name="(line74)"></a>
<a name="(line75)"></a><a name="insertView"></a><span class='varid'>insertView</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>VHtml</span>
<a name="(line76)"></a><span class='varid'>insertView</span> <span class='varid'>c</span> <span class='varid'>a</span> <span class='keyglyph'>=</span> 
<a name="(line77)"></a>             <span class='keyword'>do</span> <span class='varid'>debugM</span> <span class='varop'>$</span> <span class='str'>"    Layout: insertView : loading   "</span> <span class='varop'>++</span> <span class='varid'>c</span> <span class='varop'>++</span> <span class='str'>" - "</span> <span class='varop'>++</span> <span class='varid'>a</span>
<a name="(line78)"></a>                <span class='keyword'>let</span> <span class='varid'>converter</span> <span class='keyglyph'>=</span> <span class='keyword'>if</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='varid'>useLowerCasePaths</span>
<a name="(line79)"></a>                                    <span class='keyword'>then</span> <span class='varid'>fromUnderscore</span>
<a name="(line80)"></a>                                    <span class='keyword'>else</span> <span class='varid'>id</span>
<a name="(line81)"></a>                    <span class='varid'>filename</span>  <span class='keyglyph'>=</span> <span class='varid'>joinPath</span> <span class='varop'>$</span> <span class='varid'>map</span> <span class='varid'>normalise</span> <span class='keyglyph'>[</span><span class='varid'>converter</span> <span class='varid'>c</span><span class='layout'>,</span> <span class='varid'>converter</span> <span class='varid'>a</span><span class='keyglyph'>]</span>
<a name="(line82)"></a>                <span class='varid'>c</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>retrieveCode</span> <span class='conid'>CTView</span> <span class='layout'>(</span><span class='varid'>filename</span><span class='layout'>,</span> <span class='str'>"markup"</span><span class='layout'>)</span>
<a name="(line83)"></a>                <span class='keyword'>case</span> <span class='varid'>c</span> <span class='keyword'>of</span>
<a name="(line84)"></a>                  <span class='conid'>CodeLoadView</span>       <span class='varid'>v</span> <span class='keyword'>_</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>v</span> 
<a name="(line85)"></a>                  <span class='conid'>CodeLoadController</span> <span class='keyword'>_</span> <span class='keyword'>_</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>error</span> <span class='str'>"retrieveAndRunLayout called, but returned CodeLoadController"</span>
<a name="(line86)"></a>                  <span class='conid'>CodeLoadFailure</span>    <span class='varid'>e</span>     <span class='keyglyph'>-&gt;</span> <span class='varid'>stringToVHtml</span> <span class='varid'>e</span>
<a name="(line87)"></a> 
<a name="(line88)"></a><a name="insertComponent"></a><span class='varid'>insertComponent</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='conid'>String</span><span class='layout'>)</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>VHtml</span>
<a name="(line89)"></a><span class='varid'>insertComponent</span> <span class='varid'>controller</span> <span class='varid'>action</span> <span class='varid'>opts</span> <span class='keyglyph'>=</span>
<a name="(line90)"></a>           <span class='keyword'>do</span> <span class='varid'>debugM</span> <span class='varop'>$</span> <span class='str'>" insertComponent: Starting"</span>
<a name="(line91)"></a>              <span class='varid'>p</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>retrieveCode</span> <span class='conid'>CTComponentController</span> <span class='layout'>(</span><span class='varid'>joinPath</span> <span class='keyglyph'>[</span><span class='varid'>controller</span><span class='layout'>,</span><span class='str'>"Controller"</span><span class='keyglyph'>]</span><span class='layout'>,</span>  <span class='layout'>(</span><span class='varid'>toLower</span> <span class='varop'>$</span> <span class='varid'>head</span> <span class='varid'>action</span><span class='layout'>)</span> <span class='conop'>:</span> <span class='layout'>(</span><span class='varid'>tail</span> <span class='varid'>action</span><span class='layout'>)</span><span class='layout'>)</span>
<a name="(line92)"></a>              <span class='keyword'>case</span> <span class='varid'>p</span> <span class='keyword'>of</span>
<a name="(line93)"></a>                 <span class='conid'>CodeLoadMissing</span>                    <span class='keyglyph'>-&gt;</span>    <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponent error: code missing : "</span> <span class='varop'>++</span> <span class='varid'>controller</span> <span class='varop'>++</span> <span class='str'>" - "</span> <span class='varop'>++</span> <span class='varid'>action</span>
<a name="(line94)"></a>                 <span class='conid'>CodeLoadFailure</span> <span class='varid'>e</span>                  <span class='keyglyph'>-&gt;</span>    <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponent error: "</span> <span class='varop'>++</span> <span class='varid'>e</span>
<a name="(line95)"></a>                 <span class='conid'>CodeLoadComponentController</span> <span class='varid'>p'</span>   <span class='keyword'>_</span> <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>oldE</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line96)"></a>                                                          <span class='varid'>mapM_</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='layout'>(</span><span class='varid'>k</span><span class='layout'>,</span> <span class='varid'>v</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>setSetting</span> <span class='varid'>k</span> <span class='varid'>v</span><span class='layout'>)</span> <span class='varid'>opts</span>
<a name="(line97)"></a>                                                          <span class='varid'>p'</span>
<a name="(line98)"></a>                                                          <span class='comment'>-- allow for overloading of the Component Controller and View</span>
<a name="(line99)"></a>                                                          <span class='varid'>c</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getSetting</span> <span class='str'>"component-controller"</span>
<a name="(line100)"></a>                                                          <span class='varid'>a</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getSetting</span> <span class='str'>"component-view"</span>
<a name="(line101)"></a>                                                          <span class='varid'>insertComponentView</span> <span class='varid'>oldE</span> <span class='layout'>(</span><span class='varid'>fromMaybe</span> <span class='varid'>controller</span> <span class='varid'>c</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>fromMaybe</span> <span class='varid'>action</span> <span class='varid'>a</span><span class='layout'>)</span>
<a name="(line102)"></a>                 <span class='keyword'>_</span>                                  <span class='keyglyph'>-&gt;</span>    <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponent error: received incorrect CodeStatus"</span>
<a name="(line103)"></a>
<a name="(line104)"></a><a name="insertComponentView"></a><span class='varid'>insertComponentView</span> <span class='keyglyph'>::</span> <span class='conid'>Environment</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>VHtml</span>
<a name="(line105)"></a><span class='varid'>insertComponentView</span> <span class='varid'>oldE</span> <span class='varid'>controller</span> <span class='varid'>action</span> <span class='keyglyph'>=</span>
<a name="(line106)"></a>           <span class='keyword'>do</span> <span class='varid'>debugM</span> <span class='varop'>$</span> <span class='str'>" insertComponentView: Starting"</span>
<a name="(line107)"></a>              <span class='varid'>v</span>  <span class='keyglyph'>&lt;-</span> <span class='varid'>retrieveCode</span> <span class='conid'>CTComponentView</span> <span class='layout'>(</span><span class='varid'>joinPath</span> <span class='keyglyph'>[</span><span class='varid'>controller</span><span class='layout'>,</span> <span class='str'>"Views"</span><span class='layout'>,</span> <span class='varid'>action</span><span class='keyglyph'>]</span><span class='layout'>,</span> <span class='str'>"markup"</span><span class='layout'>)</span>
<a name="(line108)"></a>              <span class='keyword'>case</span> <span class='varid'>v</span> <span class='keyword'>of</span>
<a name="(line109)"></a>                 <span class='conid'>CodeLoadMissing</span>                    <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>setEnvironment</span> <span class='varid'>oldE</span>
<a name="(line110)"></a>                                                          <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponentView error: code missing : "</span> <span class='varop'>++</span> <span class='layout'>(</span><span class='varid'>joinPath</span> <span class='keyglyph'>[</span><span class='varid'>controller</span><span class='layout'>,</span> <span class='varid'>action</span><span class='keyglyph'>]</span><span class='layout'>)</span> <span class='varop'>++</span> <span class='str'>" - markup"</span>
<a name="(line111)"></a>                 <span class='conid'>CodeLoadFailure</span> <span class='varid'>e</span>                  <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>setEnvironment</span> <span class='varid'>oldE</span>
<a name="(line112)"></a>                                                          <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponentView error: "</span> <span class='varop'>++</span> <span class='varid'>e</span>
<a name="(line113)"></a>                 <span class='conid'>CodeLoadComponentView</span> <span class='varid'>v'</span> <span class='keyword'>_</span>   <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>res</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>v'</span>
<a name="(line114)"></a>                                                    <span class='varid'>setEnvironment</span> <span class='varid'>oldE</span>
<a name="(line115)"></a>                                                    <span class='varid'>return</span> <span class='varid'>res</span>
<a name="(line116)"></a>                 <span class='keyword'>_</span>                            <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>setEnvironment</span> <span class='varid'>oldE</span>
<a name="(line117)"></a>                                                    <span class='varid'>stringToVHtml</span> <span class='varop'>$</span> <span class='str'>"insertComponentView error"</span>
<a name="(line118)"></a>
</pre></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span> <span class='keyword'>where</span>
<a name="(line2)"></a>
<a name="(line3)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Dynamic</span>
<a name="(line4)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='keyword'>as</span> <span class='conid'>M</span>
<a name="(line5)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Maybe</span>
<a name="(line6)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Time</span>
<a name="(line7)"></a><span class='keyword'>import</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>IO</span>
<a name="(line8)"></a><span class='keyword'>import</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>IO</span><span class='varop'>.</span><span class='conid'>Unsafe</span>
<a name="(line9)"></a><span class='keyword'>import</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>Log</span><span class='varop'>.</span><span class='conid'>Logger</span>
<a name="(line10)"></a><span class='keyword'>import</span> <span class='conid'>Text</span><span class='varop'>.</span><span class='conid'>Regex</span>
<a name="(line11)"></a><span class='keyword'>import</span> <span class='conid'>Text</span><span class='varop'>.</span><span class='conid'>XHtml</span><span class='varop'>.</span><span class='conid'>Strict</span>
<a name="(line12)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Concurrent</span><span class='varop'>.</span><span class='conid'>MVar</span>
<a name="(line13)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span><span class='varop'>.</span><span class='conid'>State</span>
<a name="(line14)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>HTTP</span> <span class='keyword'>as</span> <span class='conid'>HTTP</span>
<a name="(line15)"></a><span class='keyword'>import</span> <span class='conid'>Database</span><span class='varop'>.</span><span class='conid'>HDBC</span>
<a name="(line16)"></a><span class='keyword'>import</span> <span class='conid'>Codec</span><span class='varop'>.</span><span class='conid'>MIME</span><span class='varop'>.</span><span class='conid'>Type</span> <span class='layout'>(</span><span class='conid'>MIMEValue</span><span class='layout'>)</span>
<a name="(line17)"></a>
<a name="(line18)"></a><a name="HasEnvironment"></a><span class='comment'>-- | The class of types which hold an 'Environment'.</span>
<a name="(line19)"></a><a name="HasEnvironment"></a><span class='comment'>-- 'View' and 'Controller' are both instances of this class.</span>
<a name="(line20)"></a><a name="HasEnvironment"></a><span class='keyword'>class</span> <span class='layout'>(</span><span class='conid'>MonadIO</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>HasEnvironment</span> <span class='varid'>m</span> <span class='keyword'>where</span>
<a name="(line21)"></a>  <span class='varid'>getEnvironment</span> <span class='keyglyph'>::</span> <span class='varid'>m</span> <span class='conid'>Environment</span>
<a name="(line22)"></a>  <span class='varid'>setEnvironment</span> <span class='keyglyph'>::</span> <span class='conid'>Environment</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line23)"></a>
<a name="(line24)"></a><span class='keyword'>instance</span> <span class='conid'>HasEnvironment</span> <span class='layout'>(</span><span class='conid'>StateT</span> <span class='conid'>Environment</span> <span class='conid'>IO</span><span class='layout'>)</span> <span class='keyword'>where</span>
<a name="(line25)"></a>  <span class='varid'>getEnvironment</span> <span class='keyglyph'>=</span> <span class='varid'>get</span>
<a name="(line26)"></a>  <span class='varid'>setEnvironment</span> <span class='keyglyph'>=</span> <span class='varid'>put</span>
<a name="(line27)"></a>
<a name="(line28)"></a><a name="Environment"></a><span class='comment'>-- | The Environment in which each request is handled.</span>
<a name="(line29)"></a><a name="Environment"></a><span class='comment'>-- All components are held within 'Maybe's so that the</span>
<a name="(line30)"></a><a name="Environment"></a><span class='comment'>-- Environment can be partially constructed.</span>
<a name="(line31)"></a><a name="Environment"></a><span class='keyword'>data</span> <span class='conid'>Environment</span> <span class='keyglyph'>=</span>  <span class='conid'>Environment</span> <span class='layout'>{</span> <span class='varid'>getCodeStore</span>      <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>CodeStore</span>
<a name="(line32)"></a>                                <span class='layout'>,</span> <span class='varid'>getDatabase</span>       <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>ConnWrapper</span>
<a name="(line33)"></a>                                <span class='layout'>,</span> <span class='varid'>getFiles</span>          <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Files</span>
<a name="(line34)"></a>                                <span class='layout'>,</span> <span class='varid'>getLoggerLock</span>     <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>LoggerLock</span>
<a name="(line35)"></a>                                <span class='layout'>,</span> <span class='varid'>getMimeTypes</span>      <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>MimeTypes</span>
<a name="(line36)"></a>                                <span class='layout'>,</span> <span class='varid'>getParams</span>         <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Params</span>
<a name="(line37)"></a>                                <span class='layout'>,</span> <span class='varid'>getRequest</span>        <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='layout'>(</span><span class='conid'>HTTP</span><span class='varop'>.</span><span class='conid'>Request</span> <span class='conid'>String</span><span class='layout'>)</span>
<a name="(line38)"></a>                                <span class='layout'>,</span> <span class='varid'>getResponse</span>       <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='layout'>(</span><span class='conid'>HTTP</span><span class='varop'>.</span><span class='conid'>Response</span> <span class='conid'>String</span><span class='layout'>)</span>
<a name="(line39)"></a>                                <span class='layout'>,</span> <span class='varid'>getRoutes</span>         <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Routes</span>
<a name="(line40)"></a>                                <span class='layout'>,</span> <span class='varid'>getSession</span>        <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Session</span>
<a name="(line41)"></a>                                <span class='layout'>,</span> <span class='varid'>getSettings</span>       <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Settings</span>
<a name="(line42)"></a>                                <span class='layout'>,</span> <span class='varid'>getViewData</span>       <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>ViewData</span>
<a name="(line43)"></a>                                <span class='layout'>,</span> <span class='varid'>getAppEnvironment</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='layout'>(</span><span class='conid'>MVar</span> <span class='conid'>Dynamic</span><span class='layout'>)</span>
<a name="(line44)"></a>                                <span class='layout'>}</span>
<a name="(line45)"></a>
<a name="(line46)"></a><a name="newEnvironment"></a><span class='comment'>-- | Construct a new empty 'Environment'.</span>
<a name="(line47)"></a><span class='varid'>newEnvironment</span> <span class='keyglyph'>::</span> <span class='conid'>Environment</span>
<a name="(line48)"></a><span class='varid'>newEnvironment</span> <span class='keyglyph'>=</span> <span class='conid'>Environment</span> <span class='layout'>{</span> <span class='varid'>getCodeStore</span>      <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line49)"></a>                             <span class='layout'>,</span> <span class='varid'>getDatabase</span>       <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line50)"></a>                             <span class='layout'>,</span> <span class='varid'>getFiles</span>          <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line51)"></a>                             <span class='layout'>,</span> <span class='varid'>getLoggerLock</span>     <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line52)"></a>                             <span class='layout'>,</span> <span class='varid'>getMimeTypes</span>      <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line53)"></a>                             <span class='layout'>,</span> <span class='varid'>getParams</span>         <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line54)"></a>                             <span class='layout'>,</span> <span class='varid'>getRequest</span>        <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line55)"></a>                             <span class='layout'>,</span> <span class='varid'>getResponse</span>       <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line56)"></a>                             <span class='layout'>,</span> <span class='varid'>getRoutes</span>         <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line57)"></a>                             <span class='layout'>,</span> <span class='varid'>getSession</span>        <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line58)"></a>                             <span class='layout'>,</span> <span class='varid'>getSettings</span>       <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line59)"></a>                             <span class='layout'>,</span> <span class='varid'>getViewData</span>       <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line60)"></a>                             <span class='layout'>,</span> <span class='varid'>getAppEnvironment</span> <span class='keyglyph'>=</span> <span class='conid'>Nothing</span>
<a name="(line61)"></a>                             <span class='layout'>}</span>
<a name="(line62)"></a>
<a name="(line63)"></a><span class='comment'>--</span>
<a name="(line64)"></a><span class='comment'>-- * Types for CodeStore</span>
<a name="(line65)"></a><span class='comment'>--</span>
<a name="(line66)"></a>
<a name="(line67)"></a><a name="CodeType"></a><span class='keyword'>data</span> <span class='conid'>CodeType</span> <span class='keyglyph'>=</span> <span class='conid'>CTView</span> <span class='keyglyph'>|</span> <span class='conid'>CTController</span> <span class='keyglyph'>|</span> <span class='conid'>CTComponentView</span> <span class='keyglyph'>|</span> <span class='conid'>CTComponentController</span> <span class='keyglyph'>|</span> <span class='conid'>CTLayout</span> <span class='keyword'>deriving</span> <span class='layout'>(</span><span class='conid'>Show</span><span class='layout'>)</span>
<a name="(line68)"></a><a name="CodeDate"></a><span class='keyword'>type</span> <span class='conid'>CodeDate</span>      <span class='keyglyph'>=</span> <span class='conid'>UTCTime</span>
<a name="(line69)"></a><a name="Function"></a><span class='keyword'>type</span> <span class='conid'>Function</span>      <span class='keyglyph'>=</span> <span class='conid'>String</span>
<a name="(line70)"></a><a name="CodeLocation"></a><span class='keyword'>type</span> <span class='conid'>CodeLocation</span>  <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='conid'>FilePath</span><span class='layout'>,</span> <span class='conid'>Function</span><span class='layout'>)</span>
<a name="(line71)"></a>
<a name="(line72)"></a><a name="CodeStore"></a><span class='keyword'>data</span> <span class='conid'>CodeStore</span>  <span class='keyglyph'>=</span> <span class='conid'>CodeStore</span> <span class='layout'>(</span><span class='conid'>MVar</span> <span class='conid'>CodeMap</span><span class='layout'>)</span>
<a name="(line73)"></a><a name="CodeMap"></a><span class='keyword'>type</span> <span class='conid'>CodeMap</span>    <span class='keyglyph'>=</span> <span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>CodeLocation</span> <span class='conid'>CodeStatus</span>
<a name="(line74)"></a><a name="CodeStatus"></a><span class='keyword'>data</span> <span class='conid'>CodeStatus</span> <span class='keyglyph'>=</span> <span class='conid'>CodeLoadMissing</span> <span class='keyglyph'>|</span>
<a name="(line75)"></a>                  <span class='conid'>CodeLoadFailure</span> <span class='conid'>String</span> <span class='keyglyph'>|</span>
<a name="(line76)"></a>                  <span class='conid'>CodeLoadController</span>          <span class='layout'>(</span><span class='conid'>StateT</span> <span class='conid'>Environment</span> <span class='conid'>IO</span> <span class='conid'>()</span><span class='layout'>)</span>                 <span class='conid'>CodeDate</span> <span class='keyglyph'>|</span>
<a name="(line77)"></a>                  <span class='conid'>CodeLoadView</span>                <span class='layout'>(</span><span class='conid'>StateT</span> <span class='conid'>Environment</span> <span class='conid'>IO</span> <span class='conid'>Html</span><span class='layout'>)</span> <span class='conid'>CodeDate</span> <span class='keyglyph'>|</span>
<a name="(line78)"></a>                  <span class='conid'>CodeLoadComponentController</span> <span class='layout'>(</span><span class='conid'>StateT</span> <span class='conid'>Environment</span> <span class='conid'>IO</span> <span class='conid'>()</span><span class='layout'>)</span>                 <span class='conid'>CodeDate</span> <span class='keyglyph'>|</span>
<a name="(line79)"></a>                  <span class='conid'>CodeLoadComponentView</span>       <span class='layout'>(</span><span class='conid'>StateT</span> <span class='conid'>Environment</span> <span class='conid'>IO</span> <span class='conid'>Html</span><span class='layout'>)</span> <span class='conid'>CodeDate</span>
<a name="(line80)"></a>
<a name="(line81)"></a>
<a name="(line82)"></a><span class='comment'>--</span>
<a name="(line83)"></a><span class='comment'>-- * Types for Cookies</span>
<a name="(line84)"></a><span class='comment'>--</span>
<a name="(line85)"></a>
<a name="(line86)"></a><a name="Cookie"></a><span class='comment'>-- | Contains all information about a cookie set by the server.</span>
<a name="(line87)"></a><a name="Cookie"></a><span class='keyword'>data</span> <span class='conid'>Cookie</span> <span class='keyglyph'>=</span> <span class='conid'>Cookie</span> <span class='layout'>{</span>
<a name="(line88)"></a>                      <span class='comment'>-- | Name of the cookie.</span>
<a name="(line89)"></a>                      <span class='varid'>cookieName</span> <span class='keyglyph'>::</span> <span class='conid'>String</span><span class='layout'>,</span>
<a name="(line90)"></a>                      <span class='comment'>-- | Value of the cookie.</span>
<a name="(line91)"></a>                      <span class='varid'>cookieValue</span> <span class='keyglyph'>::</span> <span class='conid'>String</span><span class='layout'>,</span>
<a name="(line92)"></a>                      <span class='comment'>-- | Expiry date of the cookie. If 'Nothing', the</span>
<a name="(line93)"></a>                      <span class='comment'>--   cookie expires when the browser sessions ends.</span>
<a name="(line94)"></a>                      <span class='comment'>--   If the date is in the past, the client should</span>
<a name="(line95)"></a>                      <span class='comment'>--   delete the cookie immediately.</span>
<a name="(line96)"></a>                      <span class='varid'>cookieExpires</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>UTCTime</span><span class='layout'>,</span>
<a name="(line97)"></a>                      <span class='comment'>-- | The domain suffix to which this cookie will be sent.</span>
<a name="(line98)"></a>                      <span class='varid'>cookieDomain</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>String</span><span class='layout'>,</span>
<a name="(line99)"></a>                      <span class='comment'>-- | The path to which this cookie will be sent.</span>
<a name="(line100)"></a>                      <span class='varid'>cookiePath</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>String</span>
<a name="(line101)"></a>                      <span class='layout'>}</span>
<a name="(line102)"></a>            <span class='keyword'>deriving</span> <span class='layout'>(</span><span class='conid'>Show</span><span class='layout'>,</span> <span class='conid'>Read</span><span class='layout'>,</span> <span class='conid'>Eq</span><span class='layout'>,</span> <span class='conid'>Ord</span><span class='layout'>)</span>
<a name="(line103)"></a>
<a name="(line104)"></a><span class='comment'>--</span>
<a name="(line105)"></a><span class='comment'>-- * Types for Files</span>
<a name="(line106)"></a><span class='comment'>--</span>
<a name="(line107)"></a>
<a name="(line108)"></a><a name="Files"></a><span class='keyword'>data</span> <span class='conid'>Files</span> <span class='keyglyph'>=</span> <span class='conid'>Files</span> <span class='layout'>(</span><span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>MIMEValue</span><span class='layout'>)</span>
<a name="(line109)"></a>
<a name="(line110)"></a><span class='comment'>--</span>
<a name="(line111)"></a><span class='comment'>-- * Types for Logger</span>
<a name="(line112)"></a><span class='comment'>--</span>
<a name="(line113)"></a>
<a name="(line114)"></a><a name="LoggerLock"></a><span class='keyword'>type</span> <span class='conid'>LoggerLock</span> <span class='keyglyph'>=</span> <span class='conid'>MVar</span> <span class='conid'>()</span>
<a name="(line115)"></a>
<a name="(line116)"></a>
<a name="(line117)"></a><span class='comment'>--</span>
<a name="(line118)"></a><span class='comment'>-- * Types for MimeTypes</span>
<a name="(line119)"></a><span class='comment'>--</span>
<a name="(line120)"></a>
<a name="(line121)"></a><a name="MimeTypes"></a><span class='keyword'>data</span> <span class='conid'>MimeTypes</span> <span class='keyglyph'>=</span> <span class='conid'>MimeTypes</span> <span class='layout'>(</span><span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>MimeType</span><span class='layout'>)</span>
<a name="(line122)"></a><a name="MimeType"></a><span class='keyword'>data</span> <span class='conid'>MimeType</span> <span class='keyglyph'>=</span> <span class='conid'>MimeType</span> <span class='conid'>String</span> <span class='conid'>String</span>
<a name="(line123)"></a>
<a name="(line124)"></a><span class='keyword'>instance</span> <span class='conid'>Show</span> <span class='conid'>MimeType</span> <span class='keyword'>where</span>
<a name="(line125)"></a>     <span class='varid'>showsPrec</span> <span class='keyword'>_</span> <span class='layout'>(</span><span class='conid'>MimeType</span> <span class='varid'>part1</span> <span class='varid'>part2</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='varid'>showString</span> <span class='layout'>(</span><span class='varid'>part1</span> <span class='varop'>++</span> <span class='chr'>'/'</span><span class='conop'>:</span><span class='varid'>part2</span><span class='layout'>)</span>
<a name="(line126)"></a>
<a name="(line127)"></a><span class='comment'>--</span>
<a name="(line128)"></a><span class='comment'>-- * Types for Files</span>
<a name="(line129)"></a><span class='comment'>--</span>
<a name="(line130)"></a>
<a name="(line131)"></a><a name="Params"></a><span class='keyword'>data</span> <span class='conid'>Params</span> <span class='keyglyph'>=</span> <span class='conid'>Params</span> <span class='layout'>(</span><span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>String</span><span class='layout'>)</span>
<a name="(line132)"></a>
<a name="(line133)"></a><span class='comment'>--</span>
<a name="(line134)"></a><span class='comment'>-- * Types for Request</span>
<a name="(line135)"></a><span class='comment'>--</span>
<a name="(line136)"></a>
<a name="(line137)"></a><span class='comment'>-- Just a basic Request from Network.HTTP</span>
<a name="(line138)"></a>
<a name="(line139)"></a><span class='comment'>--</span>
<a name="(line140)"></a><span class='comment'>-- * Types for Response</span>
<a name="(line141)"></a><span class='comment'>--</span>
<a name="(line142)"></a>
<a name="(line143)"></a><span class='comment'>-- Just a basic Response from Network.HTTP</span>
<a name="(line144)"></a>
<a name="(line145)"></a><span class='comment'>--</span>
<a name="(line146)"></a><span class='comment'>-- * Types for Routes</span>
<a name="(line147)"></a><span class='comment'>--</span>
<a name="(line148)"></a>
<a name="(line149)"></a><a name="Keys"></a><span class='keyword'>type</span> <span class='conid'>Keys</span> <span class='keyglyph'>=</span> <span class='keyglyph'>[</span><span class='conid'>String</span><span class='keyglyph'>]</span>
<a name="(line150)"></a><a name="Routes"></a><span class='keyword'>data</span> <span class='conid'>Routes</span> <span class='keyglyph'>=</span> <span class='conid'>Routes</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>Regex</span><span class='layout'>,</span> <span class='conid'>Keys</span><span class='layout'>)</span><span class='keyglyph'>]</span>
<a name="(line151)"></a>
<a name="(line152)"></a><a name="Session"></a><span class='comment'>--</span>
<a name="(line153)"></a><a name="Session"></a><span class='comment'>-- * Types for Session</span>
<a name="(line154)"></a><a name="Session"></a><span class='comment'>--</span>
<a name="(line155)"></a><a name="Session"></a><span class='keyword'>data</span> <span class='conid'>Session</span> <span class='keyglyph'>=</span> <span class='conid'>Session</span> <span class='layout'>{</span>
<a name="(line156)"></a>    <span class='varid'>sessionName</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>String</span><span class='layout'>,</span>  <span class='comment'>-- Used by Cookie session</span>
<a name="(line157)"></a>    <span class='varid'>sessionId</span>   <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Int</span><span class='layout'>,</span>     <span class='comment'>-- Used by DB and Filesystem sessions</span>
<a name="(line158)"></a>    <span class='varid'>expires</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>UTCTime</span><span class='layout'>,</span>
<a name="(line159)"></a>    <span class='varid'>dataRep</span> <span class='keyglyph'>::</span> <span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>String</span>
<a name="(line160)"></a>    <span class='layout'>}</span> <span class='keyword'>deriving</span> <span class='layout'>(</span><span class='conid'>Eq</span><span class='layout'>,</span> <span class='conid'>Read</span><span class='layout'>,</span> <span class='conid'>Show</span><span class='layout'>)</span>
<a name="(line161)"></a>
<a name="(line162)"></a><a name="emptySession"></a><span class='varid'>emptySession</span> <span class='keyglyph'>=</span> <span class='conid'>Session</span> <span class='conid'>Nothing</span> <span class='conid'>Nothing</span> <span class='conid'>Nothing</span> <span class='conid'>M</span><span class='varop'>.</span><span class='varid'>empty</span>
<a name="(line163)"></a>
<a name="(line164)"></a><a name="HasSession"></a><span class='keyword'>class</span> <span class='conid'>HasSession</span> <span class='varid'>m</span> <span class='keyword'>where</span>
<a name="(line165)"></a>  <span class='varid'>newSession</span>      <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='conid'>String</span><span class='layout'>)</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line166)"></a>  <span class='varid'>retrieveSession</span> <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='conid'>String</span><span class='layout'>)</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line167)"></a>  <span class='varid'>persistSession</span>  <span class='keyglyph'>::</span> <span class='keyglyph'>[</span><span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='conid'>String</span><span class='layout'>)</span><span class='keyglyph'>]</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line168)"></a>  <span class='varid'>hasValidSession</span>  <span class='keyglyph'>::</span> <span class='varid'>m</span> <span class='conid'>Bool</span>
<a name="(line169)"></a>  <span class='varid'>abandonSession</span>  <span class='keyglyph'>::</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line170)"></a>  <span class='varid'>getSessionValue</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='layout'>(</span><span class='conid'>Maybe</span> <span class='conid'>String</span><span class='layout'>)</span>
<a name="(line171)"></a>  <span class='varid'>setSessionValue</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line172)"></a>  <span class='varid'>deleteSessionKey</span> <span class='keyglyph'>::</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line173)"></a>  <span class='varid'>getSessionId</span>   <span class='keyglyph'>::</span> <span class='varid'>m</span> <span class='layout'>(</span><span class='conid'>Maybe</span> <span class='conid'>Int</span><span class='layout'>)</span>
<a name="(line174)"></a>  <span class='varid'>setSessionId</span>   <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>Int</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line175)"></a>  <span class='varid'>getSessionExpires</span> <span class='keyglyph'>::</span> <span class='varid'>m</span> <span class='layout'>(</span><span class='conid'>Maybe</span> <span class='conid'>UTCTime</span><span class='layout'>)</span>
<a name="(line176)"></a>  <span class='varid'>setSessionExpires</span> <span class='keyglyph'>::</span> <span class='conid'>Maybe</span> <span class='conid'>UTCTime</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line177)"></a>
<a name="(line178)"></a><span class='comment'>--</span>
<a name="(line179)"></a><span class='comment'>-- * Types for Settings</span>
<a name="(line180)"></a><span class='comment'>--</span>
<a name="(line181)"></a>
<a name="(line182)"></a><a name="Settings"></a><span class='keyword'>type</span> <span class='conid'>Settings</span> <span class='keyglyph'>=</span> <span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>Dynamic</span>
<a name="(line183)"></a>
<a name="(line184)"></a><span class='comment'>--</span>
<a name="(line185)"></a><span class='comment'>-- * Types for ViewData</span>
<a name="(line186)"></a><span class='comment'>--</span>
<a name="(line187)"></a>
<a name="(line188)"></a><a name="ViewData"></a><span class='keyword'>type</span> <span class='conid'>ViewData</span> <span class='keyglyph'>=</span> <span class='conid'>M</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='conid'>String</span> <span class='conid'>Dynamic</span>
<a name="(line189)"></a>
</pre></body>
</html>

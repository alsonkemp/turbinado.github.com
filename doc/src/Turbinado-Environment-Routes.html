<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Routes</span> <span class='layout'>(</span>
<a name="(line2)"></a>    <span class='varid'>addRoutesToEnvironment</span><span class='layout'>,</span>
<a name="(line3)"></a>    <span class='varid'>runRoutes</span>
<a name="(line4)"></a>    <span class='layout'>)</span> <span class='keyword'>where</span>
<a name="(line5)"></a>
<a name="(line6)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Concurrent</span><span class='varop'>.</span><span class='conid'>MVar</span>
<a name="(line7)"></a><span class='keyword'>import</span> <span class='conid'>Text</span><span class='varop'>.</span><span class='conid'>Regex</span>
<a name="(line8)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Maybe</span>
<a name="(line9)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Typeable</span>
<a name="(line10)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Dynamic</span>
<a name="(line11)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='keyword'>as</span> <span class='conid'>M</span>
<a name="(line12)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Time</span>
<a name="(line13)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span>
<a name="(line14)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>HTTP</span> <span class='keyword'>as</span> <span class='conid'>HTTP</span>
<a name="(line15)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>URI</span> <span class='keyword'>as</span> <span class='conid'>URI</span>
<a name="(line16)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Controller</span><span class='varop'>.</span><span class='conid'>Monad</span>
<a name="(line17)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Controller</span><span class='varop'>.</span><span class='conid'>Exception</span>
<a name="(line18)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span>
<a name="(line19)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Logger</span>
<a name="(line20)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Request</span>
<a name="(line21)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Settings</span>
<a name="(line22)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Settings</span> <span class='keyword'>as</span> <span class='conid'>S</span>
<a name="(line23)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Utility</span><span class='varop'>.</span><span class='conid'>Data</span>
<a name="(line24)"></a>
<a name="(line25)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span>
<a name="(line26)"></a>
<a name="(line27)"></a><a name="addRoutesToEnvironment"></a><span class='varid'>addRoutesToEnvironment</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line28)"></a><span class='varid'>addRoutesToEnvironment</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line29)"></a>                            <span class='keyword'>let</span> <span class='conid'>CodeStore</span> <span class='varid'>mv</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust'</span> <span class='str'>"Turbinado.Environment.Routes.addRoutesToEnvironment : no CodeStore"</span> <span class='varop'>$</span> <span class='varid'>getCodeStore</span> <span class='varid'>e</span>
<a name="(line30)"></a>                            <span class='varid'>cm</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>takeMVar</span> <span class='varid'>mv</span>
<a name="(line31)"></a>                            <span class='keyword'>let</span> <span class='varid'>cm'</span>  <span class='keyglyph'>=</span> <span class='varid'>addStaticControllers</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span><span class='varop'>.</span><span class='varid'>staticControllers</span> <span class='varid'>cm</span>
<a name="(line32)"></a>                                <span class='varid'>cm''</span> <span class='keyglyph'>=</span> <span class='varid'>addStaticViews</span> <span class='layout'>(</span><span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span><span class='varop'>.</span><span class='varid'>staticViews</span> <span class='varop'>++</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span><span class='varop'>.</span><span class='varid'>staticLayouts</span><span class='layout'>)</span> <span class='varid'>cm'</span>
<a name="(line33)"></a>                            <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>putMVar</span> <span class='varid'>mv</span> <span class='varid'>cm''</span>
<a name="(line34)"></a>                            <span class='varid'>setEnvironment</span> <span class='varop'>$</span> <span class='varid'>e</span> <span class='layout'>{</span>
<a name="(line35)"></a>                              <span class='varid'>getRoutes</span> <span class='keyglyph'>=</span> <span class='conid'>Just</span> <span class='varop'>$</span> <span class='conid'>Routes</span> <span class='varop'>$</span> <span class='varid'>parseRoutes</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span><span class='varop'>.</span><span class='varid'>routes</span><span class='layout'>}</span>
<a name="(line36)"></a>
<a name="(line37)"></a>
<a name="(line38)"></a><span class='comment'>------------------------------------------------------------------------------</span>
<a name="(line39)"></a><span class='comment'>-- Given an Environment</span>
<a name="(line40)"></a><span class='comment'>------------------------------------------------------------------------------</span>
<a name="(line41)"></a>
<a name="(line42)"></a><a name="runRoutes"></a><span class='varid'>runRoutes</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line43)"></a><span class='varid'>runRoutes</span>   <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>debugM</span> <span class='varop'>$</span> <span class='str'>"  Routes.runRoutes : starting"</span>
<a name="(line44)"></a>                 <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line45)"></a>                 <span class='keyword'>let</span> <span class='conid'>Routes</span> <span class='varid'>rs</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust'</span> <span class='str'>"Routes : runRoutes : getRoutes"</span> <span class='varop'>$</span> <span class='varid'>getRoutes</span> <span class='varid'>e</span>
<a name="(line46)"></a>                     <span class='varid'>r</span>         <span class='keyglyph'>=</span> <span class='varid'>fromJust'</span> <span class='str'>"Routes : runRoutes : getRequest"</span> <span class='varop'>$</span> <span class='varid'>getRequest</span> <span class='varid'>e</span>
<a name="(line47)"></a>                     <span class='varid'>p</span>    <span class='keyglyph'>=</span> <span class='conid'>URI</span><span class='varop'>.</span><span class='varid'>uriPath</span> <span class='varop'>$</span> <span class='conid'>HTTP</span><span class='varop'>.</span><span class='varid'>rqURI</span> <span class='varid'>r</span>
<a name="(line48)"></a>                     <span class='varid'>sets</span> <span class='keyglyph'>=</span> <span class='varid'>filter</span> <span class='layout'>(</span><span class='varid'>not</span> <span class='varop'>.</span> <span class='varid'>null</span><span class='layout'>)</span> <span class='varop'>$</span> <span class='varid'>map</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='layout'>(</span><span class='varid'>r</span><span class='layout'>,</span> <span class='varid'>k</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>maybe</span> <span class='conid'>[]</span> <span class='layout'>(</span><span class='varid'>zip</span> <span class='varid'>k</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>matchRegex</span> <span class='varid'>r</span> <span class='varid'>p</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varid'>rs</span>
<a name="(line49)"></a>                 <span class='keyword'>case</span> <span class='varid'>sets</span> <span class='keyword'>of</span>
<a name="(line50)"></a>                  <span class='conid'>[]</span> <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>setSetting</span> <span class='str'>"controller"</span> <span class='varop'>$</span> <span class='varid'>last</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Routes</span><span class='varop'>.</span><span class='varid'>routes</span>  <span class='comment'>-- no match, so use the last route</span>
<a name="(line51)"></a>                           <span class='varid'>addDefaultAction</span>
<a name="(line52)"></a>                  <span class='keyword'>_</span>  <span class='keyglyph'>-&gt;</span> <span class='keyword'>do</span> <span class='varid'>mapM</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='layout'>(</span><span class='varid'>k</span><span class='layout'>,</span> <span class='varid'>v</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>setSetting</span> <span class='varid'>k</span> <span class='varid'>v</span><span class='layout'>)</span> <span class='varop'>$</span> <span class='varid'>head</span> <span class='varid'>sets</span>
<a name="(line53)"></a>                           <span class='varid'>addDefaultAction</span>
<a name="(line54)"></a>
<a name="(line55)"></a><a name="addDefaultAction"></a><span class='varid'>addDefaultAction</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line56)"></a><span class='varid'>addDefaultAction</span>   <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line57)"></a>                        <span class='keyword'>let</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust'</span> <span class='str'>"Routes : addDefaultAction : getSettings"</span> <span class='varop'>$</span> <span class='varid'>getSettings</span> <span class='varid'>e</span>
<a name="(line58)"></a>                        <span class='varid'>setEnvironment</span> <span class='varop'>$</span> <span class='varid'>e</span> <span class='layout'>{</span><span class='varid'>getSettings</span> <span class='keyglyph'>=</span> <span class='conid'>Just</span> <span class='layout'>(</span><span class='conid'>M</span><span class='varop'>.</span><span class='varid'>insertWith</span> <span class='layout'>(</span><span class='keyglyph'>\</span> <span class='varid'>a</span> <span class='varid'>b</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>b</span><span class='layout'>)</span> <span class='str'>"action"</span> <span class='layout'>(</span><span class='varid'>toDyn</span> <span class='str'>"Index"</span><span class='layout'>)</span> <span class='varid'>s</span><span class='layout'>)</span><span class='layout'>}</span>
<a name="(line59)"></a>
<a name="(line60)"></a><span class='comment'>------------------------------------------------------------------------------</span>
<a name="(line61)"></a><span class='comment'>-- Generate the Routes from [String]</span>
<a name="(line62)"></a><span class='comment'>------------------------------------------------------------------------------</span>
<a name="(line63)"></a>
<a name="(line64)"></a><a name="parseRoutes"></a><span class='varid'>parseRoutes</span> <span class='keyglyph'>=</span> <span class='varid'>map</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='varid'>s</span> <span class='keyglyph'>-&gt;</span> <span class='layout'>(</span><span class='varid'>routeRegex</span> <span class='varid'>s</span><span class='layout'>,</span> <span class='varid'>extractKeys</span> <span class='varid'>s</span><span class='layout'>)</span><span class='layout'>)</span>
<a name="(line65)"></a>
<a name="(line66)"></a><a name="extractKeys"></a><span class='varid'>extractKeys</span> <span class='keyglyph'>=</span> <span class='varid'>map</span> <span class='layout'>(</span><span class='varid'>drop</span> <span class='num'>1</span><span class='layout'>)</span> <span class='varop'>.</span> <span class='varid'>filter</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='varid'>l</span> <span class='keyglyph'>-&gt;</span> <span class='layout'>(</span><span class='varid'>take</span> <span class='num'>1</span> <span class='varid'>l</span><span class='layout'>)</span> <span class='varop'>==</span> <span class='str'>":"</span><span class='layout'>)</span> <span class='varop'>.</span> <span class='layout'>(</span> <span class='keyglyph'>\</span><span class='varid'>s</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>concat</span> <span class='varop'>$</span> <span class='varid'>map</span> <span class='layout'>(</span><span class='varid'>splitOn</span> <span class='chr'>'/'</span><span class='layout'>)</span> <span class='varop'>$</span> <span class='varid'>splitOn</span> <span class='chr'>'.'</span> <span class='varid'>s</span><span class='layout'>)</span>
<a name="(line67)"></a><a name="routeRegex"></a><span class='varid'>routeRegex</span> <span class='keyglyph'>=</span> <span class='varid'>mkRegex</span> <span class='varop'>.</span> <span class='varid'>generateRouteRegex</span>
<a name="(line68)"></a>
<a name="(line69)"></a><a name="generateRouteKeysRegexString"></a><span class='varid'>generateRouteKeysRegexString</span> <span class='keyglyph'>=</span> <span class='str'>"([^/^\\.]+)"</span>
<a name="(line70)"></a><a name="generateRouteRegexRegex"></a><span class='varid'>generateRouteRegexRegex</span> <span class='keyglyph'>=</span> <span class='varid'>mkRegex</span> <span class='varid'>generateRouteKeysRegexString</span>
<a name="(line71)"></a><a name="generateRouteRegex"></a><span class='varid'>generateRouteRegex</span> <span class='keyglyph'>=</span>  <span class='keyglyph'>\</span><span class='varid'>s</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>subRegex</span> <span class='varid'>generateRouteRegexRegex</span> <span class='layout'>(</span><span class='varid'>escapePeriods</span> <span class='varid'>s</span><span class='layout'>)</span> <span class='str'>"([^/^\\.]+)"</span>
<a name="(line72)"></a>
<a name="(line73)"></a><a name="escapePeriods"></a><span class='varid'>escapePeriods</span> <span class='conid'>[]</span>     <span class='keyglyph'>=</span> <span class='conid'>[]</span>
<a name="(line74)"></a><span class='varid'>escapePeriods</span> <span class='layout'>(</span><span class='chr'>'.'</span><span class='conop'>:</span><span class='varid'>cs</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='str'>"\\."</span> <span class='varop'>++</span> <span class='varid'>escapePeriods</span> <span class='varid'>cs</span>
<a name="(line75)"></a><span class='varid'>escapePeriods</span> <span class='layout'>(</span> <span class='varid'>c</span> <span class='conop'>:</span><span class='varid'>cs</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='varid'>c</span>      <span class='conop'>:</span> <span class='varid'>escapePeriods</span> <span class='varid'>cs</span>
<a name="(line76)"></a>
<a name="(line77)"></a><a name="splitOn"></a><span class='varid'>splitOn</span> <span class='keyglyph'>::</span> <span class='conid'>Char</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='keyglyph'>[</span><span class='conid'>String</span><span class='keyglyph'>]</span>
<a name="(line78)"></a><span class='varid'>splitOn</span> <span class='varid'>c</span> <span class='varid'>l</span> <span class='keyglyph'>=</span> <span class='varid'>reverse</span> <span class='varop'>$</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='varid'>l</span> <span class='conid'>[]</span>
<a name="(line79)"></a>     <span class='keyword'>where</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='conid'>[]</span> <span class='varid'>r</span> <span class='keyglyph'>=</span> <span class='varid'>r</span>
<a name="(line80)"></a>           <span class='varid'>worker</span> <span class='varid'>c</span> <span class='layout'>(</span><span class='varid'>l</span><span class='conop'>:</span><span class='varid'>ls</span><span class='layout'>)</span> <span class='conid'>[]</span> <span class='keyglyph'>=</span> <span class='keyword'>if</span> <span class='layout'>(</span><span class='varid'>l</span> <span class='varop'>==</span> <span class='varid'>c</span><span class='layout'>)</span>
<a name="(line81)"></a>                                  <span class='keyword'>then</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='varid'>ls</span> <span class='conid'>[]</span>
<a name="(line82)"></a>                                  <span class='keyword'>else</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='varid'>ls</span> <span class='keyglyph'>[</span><span class='keyglyph'>[</span><span class='varid'>l</span><span class='keyglyph'>]</span><span class='keyglyph'>]</span>
<a name="(line83)"></a>           <span class='varid'>worker</span> <span class='varid'>c</span> <span class='layout'>(</span><span class='varid'>l</span><span class='conop'>:</span><span class='varid'>ls</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>r</span><span class='conop'>:</span><span class='varid'>rs</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='keyword'>if</span> <span class='layout'>(</span><span class='varid'>l</span> <span class='varop'>==</span> <span class='varid'>c</span><span class='layout'>)</span> 
<a name="(line84)"></a>                                      <span class='keyword'>then</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='varid'>ls</span> <span class='layout'>(</span><span class='conid'>[]</span><span class='conop'>:</span><span class='varid'>r</span><span class='conop'>:</span><span class='varid'>rs</span><span class='layout'>)</span>
<a name="(line85)"></a>                                      <span class='keyword'>else</span> <span class='varid'>worker</span> <span class='varid'>c</span> <span class='varid'>ls</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>r</span><span class='varop'>++</span><span class='keyglyph'>[</span><span class='varid'>l</span><span class='keyglyph'>]</span><span class='layout'>)</span><span class='conop'>:</span><span class='varid'>rs</span><span class='layout'>)</span>
<a name="(line86)"></a>
<a name="(line87)"></a>
<a name="(line88)"></a><span class='comment'>----------------------------------------------------------------------------</span>
<a name="(line89)"></a><span class='comment'>-- Handle static routes</span>
<a name="(line90)"></a><span class='comment'>----------------------------------------------------------------------------</span>
<a name="(line91)"></a>
<a name="(line92)"></a><a name="addStaticViews"></a><span class='comment'>--addStaticViews :: [(String, String, View VHtml)] -&gt; CodeMap -&gt; CodeMap</span>
<a name="(line93)"></a><span class='varid'>addStaticViews</span> <span class='conid'>[]</span> <span class='varid'>cm</span> <span class='keyglyph'>=</span> <span class='varid'>cm</span>
<a name="(line94)"></a><span class='varid'>addStaticViews</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>p</span><span class='layout'>,</span><span class='varid'>f</span><span class='layout'>,</span><span class='varid'>v</span><span class='layout'>)</span><span class='conop'>:</span><span class='varid'>vs</span><span class='layout'>)</span> <span class='varid'>cm</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span> <span class='varid'>cm'</span> <span class='keyglyph'>=</span> <span class='conid'>M</span><span class='varop'>.</span><span class='varid'>insert</span> <span class='layout'>(</span><span class='varid'>p</span><span class='layout'>,</span><span class='varid'>f</span><span class='layout'>)</span> <span class='layout'>(</span><span class='conid'>CodeLoadView</span> <span class='varid'>v</span> <span class='varop'>$</span> <span class='conid'>UTCTime</span> <span class='layout'>(</span><span class='conid'>ModifiedJulianDay</span> <span class='num'>1000000</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>secondsToDiffTime</span> <span class='num'>0</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varid'>cm</span> <span class='keyword'>in</span>
<a name="(line95)"></a>                                 <span class='varid'>addStaticViews</span> <span class='varid'>vs</span> <span class='varid'>cm'</span>
<a name="(line96)"></a>
<a name="(line97)"></a><a name="addStaticControllers"></a><span class='varid'>addStaticControllers</span> <span class='conid'>[]</span> <span class='varid'>cm</span> <span class='keyglyph'>=</span> <span class='varid'>cm</span>
<a name="(line98)"></a><span class='varid'>addStaticControllers</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>p</span><span class='layout'>,</span><span class='varid'>f</span><span class='layout'>,</span><span class='varid'>c</span><span class='layout'>)</span><span class='conop'>:</span><span class='varid'>cs</span><span class='layout'>)</span> <span class='varid'>cm</span> <span class='keyglyph'>=</span> <span class='keyword'>let</span> <span class='varid'>cm'</span> <span class='keyglyph'>=</span> <span class='conid'>M</span><span class='varop'>.</span><span class='varid'>insert</span> <span class='layout'>(</span><span class='varid'>p</span><span class='layout'>,</span><span class='varid'>f</span><span class='layout'>)</span> <span class='layout'>(</span><span class='conid'>CodeLoadController</span> <span class='varid'>c</span> <span class='varop'>$</span> <span class='conid'>UTCTime</span> <span class='layout'>(</span><span class='conid'>ModifiedJulianDay</span> <span class='num'>1000000</span><span class='layout'>)</span> <span class='layout'>(</span><span class='varid'>secondsToDiffTime</span> <span class='num'>0</span><span class='layout'>)</span><span class='layout'>)</span> <span class='varid'>cm</span> <span class='keyword'>in</span>
<a name="(line99)"></a>                                       <span class='varid'>addStaticControllers</span> <span class='varid'>cs</span> <span class='varid'>cm'</span>
<a name="(line100)"></a>
</pre></body>
</html>

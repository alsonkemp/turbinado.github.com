<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Logger</span> <span class='keyword'>where</span>
<a name="(line2)"></a>
<a name="(line3)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>Log</span><span class='varop'>.</span><span class='conid'>Logger</span> <span class='keyword'>as</span> <span class='conid'>L</span>
<a name="(line4)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>Log</span><span class='varop'>.</span><span class='conid'>Handler</span><span class='varop'>.</span><span class='conid'>Simple</span> <span class='keyword'>as</span> <span class='conid'>S</span>
<a name="(line5)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Concurrent</span><span class='varop'>.</span><span class='conid'>MVar</span>
<a name="(line6)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span><span class='varop'>.</span><span class='conid'>State</span>
<a name="(line7)"></a><span class='keyword'>import</span> <span class='conid'>Control</span><span class='varop'>.</span><span class='conid'>Monad</span><span class='varop'>.</span><span class='conid'>Trans</span>
<a name="(line8)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span>
<a name="(line9)"></a><span class='keyword'>import</span> <span class='conid'>Config</span><span class='varop'>.</span><span class='conid'>Master</span>
<a name="(line10)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Dynamic</span>
<a name="(line11)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Maybe</span>
<a name="(line12)"></a><span class='keyword'>import</span> <span class='conid'>System</span><span class='varop'>.</span><span class='conid'>IO</span><span class='varop'>.</span><span class='conid'>Unsafe</span>
<a name="(line13)"></a>
<a name="(line14)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Utility</span><span class='varop'>.</span><span class='conid'>Data</span>
<a name="(line15)"></a>
<a name="(line16)"></a><a name="addLoggerToEnvironment"></a><span class='varid'>addLoggerToEnvironment</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line17)"></a><span class='varid'>addLoggerToEnvironment</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line18)"></a>                            <span class='varid'>f</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='conid'>S</span><span class='varop'>.</span><span class='varid'>fileHandler</span> <span class='str'>"log"</span> <span class='varid'>logLevel</span>
<a name="(line19)"></a>                            <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='conid'>L</span><span class='varop'>.</span><span class='varid'>updateGlobalLogger</span> <span class='str'>"Turbinado"</span> <span class='layout'>(</span> <span class='conid'>L</span><span class='varop'>.</span><span class='varid'>setLevel</span> <span class='varid'>logLevel</span> <span class='varop'>.</span> <span class='conid'>L</span><span class='varop'>.</span><span class='varid'>setHandlers</span> <span class='keyglyph'>[</span><span class='varid'>f</span><span class='keyglyph'>]</span><span class='layout'>)</span>
<a name="(line20)"></a>                            <span class='varid'>mv</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>newMVar</span> <span class='conid'>()</span>
<a name="(line21)"></a>                            <span class='varid'>setEnvironment</span> <span class='varop'>$</span> <span class='varid'>e</span> <span class='layout'>{</span><span class='varid'>getLoggerLock</span> <span class='keyglyph'>=</span> <span class='conid'>Just</span> <span class='varid'>mv</span><span class='layout'>}</span>
<a name="(line22)"></a>
<a name="(line23)"></a><a name="takeLoggerLock"></a><span class='varid'>takeLoggerLock</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line24)"></a><span class='varid'>takeLoggerLock</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line25)"></a>                    <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>takeMVar</span> <span class='layout'>(</span><span class='varid'>fromJust'</span> <span class='str'>"Logger: takeLoggerLock"</span> <span class='varop'>$</span> <span class='varid'>getLoggerLock</span> <span class='varid'>e</span><span class='layout'>)</span>
<a name="(line26)"></a>
<a name="(line27)"></a><a name="putLoggerLock"></a><span class='varid'>putLoggerLock</span>  <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line28)"></a><span class='varid'>putLoggerLock</span> <span class='keyglyph'>=</span>  <span class='keyword'>do</span> <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line29)"></a>                    <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>putMVar</span> <span class='layout'>(</span><span class='varid'>fromJust'</span> <span class='str'>"Logger: putLoggerLock"</span> <span class='varop'>$</span> <span class='varid'>getLoggerLock</span> <span class='varid'>e</span><span class='layout'>)</span> <span class='conid'>()</span>
<a name="(line30)"></a>
<a name="(line31)"></a><a name="wrapLoggerLock"></a><span class='varid'>wrapLoggerLock</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='layout'>(</span><span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>IO</span> <span class='conid'>()</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line32)"></a><span class='varid'>wrapLoggerLock</span> <span class='varid'>lf</span> <span class='varid'>s</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>takeLoggerLock</span>
<a name="(line33)"></a>                         <span class='varid'>liftIO</span> <span class='varop'>$</span> <span class='varid'>lf</span> <span class='varid'>s</span>
<a name="(line34)"></a>                         <span class='varid'>putLoggerLock</span>
<a name="(line35)"></a>
<a name="(line36)"></a><a name="debugM"></a><span class='varid'>debugM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line37)"></a><span class='varid'>debugM</span>        <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>DEBUG</span><span class='layout'>)</span>
<a name="(line38)"></a><a name="infoM"></a><span class='varid'>infoM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line39)"></a><span class='varid'>infoM</span>         <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>INFO</span><span class='layout'>)</span>
<a name="(line40)"></a><a name="noticeM"></a><span class='varid'>noticeM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line41)"></a><span class='varid'>noticeM</span>       <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>NOTICE</span><span class='layout'>)</span>
<a name="(line42)"></a><a name="warningM"></a><span class='varid'>warningM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line43)"></a><span class='varid'>warningM</span>      <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>WARNING</span><span class='layout'>)</span>
<a name="(line44)"></a><a name="errorM"></a><span class='varid'>errorM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line45)"></a><span class='varid'>errorM</span>        <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>ERROR</span><span class='layout'>)</span>
<a name="(line46)"></a><a name="criticalM"></a><span class='varid'>criticalM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line47)"></a><span class='varid'>criticalM</span>     <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>CRITICAL</span><span class='layout'>)</span>
<a name="(line48)"></a><a name="alertM"></a><span class='varid'>alertM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line49)"></a><span class='varid'>alertM</span>        <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>ALERT</span><span class='layout'>)</span>
<a name="(line50)"></a><a name="emergencyM"></a><span class='varid'>emergencyM</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>()</span>
<a name="(line51)"></a><span class='varid'>emergencyM</span>    <span class='keyglyph'>=</span> <span class='varid'>wrapLoggerLock</span> <span class='layout'>(</span><span class='conid'>L</span><span class='varop'>.</span><span class='varid'>logM</span> <span class='str'>"Turbinado"</span> <span class='conid'>L</span><span class='varop'>.</span><span class='conid'>EMERGENCY</span><span class='layout'>)</span>
</pre></body>
</html>

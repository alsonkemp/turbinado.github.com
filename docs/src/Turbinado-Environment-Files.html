<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Files</span><span class='layout'>(</span>
<a name="(line2)"></a>  <span class='varid'>getFile</span><span class='layout'>,</span>
<a name="(line3)"></a>  <span class='varid'>getFile_u</span><span class='layout'>,</span>
<a name="(line4)"></a>  <span class='varid'>getFileContent</span><span class='layout'>,</span>
<a name="(line5)"></a>  <span class='varid'>getFileDecode</span>
<a name="(line6)"></a>  <span class='layout'>)</span> <span class='keyword'>where</span>
<a name="(line7)"></a>
<a name="(line8)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>ByteString</span> <span class='keyword'>as</span> <span class='conid'>BS</span>
<a name="(line9)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='keyword'>as</span> <span class='conid'>M</span>
<a name="(line10)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Maybe</span>
<a name="(line11)"></a><span class='keyword'>import</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>HTTP</span>
<a name="(line12)"></a><span class='keyword'>import</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>HTTP</span><span class='varop'>.</span><span class='conid'>Headers</span>
<a name="(line13)"></a><span class='keyword'>import</span> <span class='conid'>Network</span><span class='varop'>.</span><span class='conid'>URI</span>
<a name="(line14)"></a><span class='keyword'>import</span> <span class='conid'>Codec</span><span class='varop'>.</span><span class='conid'>MIME</span><span class='varop'>.</span><span class='conid'>Type</span>
<a name="(line15)"></a><span class='keyword'>import</span> <span class='conid'>Codec</span><span class='varop'>.</span><span class='conid'>MIME</span><span class='varop'>.</span><span class='conid'>Decode</span>
<a name="(line16)"></a>
<a name="(line17)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Params</span>
<a name="(line18)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Environment</span><span class='varop'>.</span><span class='conid'>Types</span>
<a name="(line19)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Utility</span><span class='varop'>.</span><span class='conid'>Data</span>
<a name="(line20)"></a>
<a name="(line21)"></a><a name="getFile"></a><span class='comment'>-- | Attempt to get a File from the POST</span>
<a name="(line22)"></a><span class='varid'>getFile</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='layout'>(</span><span class='conid'>Maybe</span> <span class='conid'>MIMEValue</span><span class='layout'>)</span>
<a name="(line23)"></a><span class='varid'>getFile</span> <span class='varid'>f</span> <span class='keyglyph'>=</span> <span class='keyword'>do</span> <span class='varid'>populateParamsAndFiles</span>
<a name="(line24)"></a>               <span class='varid'>e</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getEnvironment</span>
<a name="(line25)"></a>               <span class='keyword'>let</span> <span class='conid'>Files</span> <span class='varid'>fs</span> <span class='keyglyph'>=</span> <span class='varid'>fromJust'</span> <span class='str'>"Turbinado.Environment.Files.getFile: Files is Nothing"</span> <span class='varop'>$</span> <span class='varid'>getFiles</span> <span class='varid'>e</span>
<a name="(line26)"></a>               <span class='varid'>return</span> <span class='varop'>$</span> <span class='conid'>M</span><span class='varop'>.</span><span class='varid'>lookup</span> <span class='varid'>f</span> <span class='varid'>fs</span>
<a name="(line27)"></a>
<a name="(line28)"></a><a name="getFile_u"></a><span class='comment'>-- | An unsafe version of getFile.  Errors if the key does not exist.</span>
<a name="(line29)"></a><span class='varid'>getFile_u</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>HasEnvironment</span> <span class='varid'>m</span><span class='layout'>)</span> <span class='keyglyph'>=&gt;</span> <span class='conid'>String</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>m</span> <span class='conid'>MIMEValue</span>
<a name="(line30)"></a><span class='varid'>getFile_u</span> <span class='varid'>f</span> <span class='keyglyph'>=</span>  <span class='keyword'>do</span> <span class='varid'>r</span> <span class='keyglyph'>&lt;-</span> <span class='varid'>getFile</span> <span class='varid'>f</span>
<a name="(line31)"></a>                  <span class='varid'>maybe</span> <span class='layout'>(</span><span class='varid'>error</span> <span class='varop'>$</span> <span class='str'>"getFile_u : key does not exist - \""</span> <span class='varop'>++</span> <span class='varid'>f</span> <span class='varop'>++</span> <span class='str'>"\""</span><span class='layout'>)</span>
<a name="(line32)"></a>                         <span class='varid'>return</span>
<a name="(line33)"></a>                         <span class='varid'>r</span>
<a name="(line34)"></a>
<a name="(line35)"></a><a name="getFileContent"></a><span class='varid'>getFileContent</span> <span class='keyglyph'>::</span> <span class='conid'>MIMEValue</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line36)"></a><span class='varid'>getFileContent</span> <span class='varid'>mv</span> <span class='keyglyph'>=</span> <span class='keyword'>case</span> <span class='layout'>(</span><span class='varid'>mime_val_content</span> <span class='varid'>mv</span><span class='layout'>)</span> <span class='keyword'>of</span>
<a name="(line37)"></a>                      <span class='conid'>Single</span> <span class='varid'>c</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>c</span>
<a name="(line38)"></a>                      <span class='keyword'>_</span>        <span class='keyglyph'>-&gt;</span> <span class='varid'>error</span> <span class='str'>"Turbinado.Environment.Params.getContent: called with a Multi Content"</span>
<a name="(line39)"></a>
<a name="(line40)"></a><a name="getFileDecode"></a><span class='varid'>getFileDecode</span> <span class='keyglyph'>::</span> <span class='conid'>MIMEValue</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line41)"></a><span class='varid'>getFileDecode</span> <span class='varid'>mv</span> <span class='keyglyph'>=</span> 
<a name="(line42)"></a>  <span class='keyword'>case</span> <span class='layout'>(</span><span class='varid'>mime_val_content</span> <span class='varid'>mv</span><span class='layout'>)</span> <span class='keyword'>of</span>
<a name="(line43)"></a>    <span class='comment'>--Single c -&gt; decodeBody "base64" c</span>
<a name="(line44)"></a>    <span class='conid'>Single</span> <span class='varid'>c</span> <span class='keyglyph'>-&gt;</span> <span class='varid'>decodeWords</span> <span class='varid'>c</span>
<a name="(line45)"></a>    <span class='keyword'>_</span>        <span class='keyglyph'>-&gt;</span> <span class='varid'>error</span> <span class='str'>"Turbinado.Environment.Params.getContent: called with a Multi Content"</span> 
</pre></body>
</html>

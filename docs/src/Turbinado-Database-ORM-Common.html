<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell Code by HsColour</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="(line1)"></a><span class='keyword'>module</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Database</span><span class='varop'>.</span><span class='conid'>ORM</span><span class='varop'>.</span><span class='conid'>Common</span> <span class='keyword'>where</span>
<a name="(line2)"></a>
<a name="(line3)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Char</span>
<a name="(line4)"></a><span class='keyword'>import</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>List</span>
<a name="(line5)"></a><span class='keyword'>import</span> <span class='keyword'>qualified</span> <span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Map</span> <span class='keyword'>as</span> <span class='conid'>M</span>
<a name="(line6)"></a><span class='keyword'>import</span> <span class='conid'>Database</span><span class='varop'>.</span><span class='conid'>HDBC</span>
<a name="(line7)"></a>
<a name="(line8)"></a><span class='keyword'>import</span> <span class='conid'>Turbinado</span><span class='varop'>.</span><span class='conid'>Database</span><span class='varop'>.</span><span class='conid'>ORM</span><span class='varop'>.</span><span class='conid'>Types</span>
<a name="(line9)"></a>
<a name="(line10)"></a><a name="cols"></a><span class='comment'>---------------------------------------------------------------------------</span>
<a name="(line11)"></a><span class='comment'>--  Utility functions                                                    --</span>
<a name="(line12)"></a><span class='comment'>---------------------------------------------------------------------------</span>
<a name="(line13)"></a><span class='varid'>cols</span> <span class='keyglyph'>::</span> <span class='conid'>Columns</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line14)"></a><span class='varid'>cols</span> <span class='varid'>cs</span> <span class='keyglyph'>=</span> <span class='varid'>unwords</span> <span class='varop'>$</span>  <span class='varid'>intersperse</span> <span class='str'>","</span> <span class='varop'>$</span> <span class='varid'>map</span> <span class='layout'>(</span><span class='keyglyph'>\</span><span class='varid'>s</span> <span class='keyglyph'>-&gt;</span> <span class='str'>"\\\""</span> <span class='varop'>++</span> <span class='varid'>s</span> <span class='varop'>++</span> <span class='str'>"\\\""</span><span class='layout'>)</span> <span class='varop'>$</span> <span class='conid'>M</span><span class='varop'>.</span><span class='varid'>keys</span> <span class='varid'>cs</span>
<a name="(line15)"></a>
<a name="(line16)"></a><a name="columnToFieldLabel"></a><span class='varid'>columnToFieldLabel</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='layout'>(</span><span class='conid'>SqlColDesc</span><span class='layout'>,</span> <span class='conid'>ForeignKeyReferences</span><span class='layout'>,</span> <span class='conid'>HasDefault</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line17)"></a><span class='varid'>columnToFieldLabel</span> <span class='varid'>cd</span><span class='keyglyph'>@</span><span class='layout'>(</span><span class='varid'>name</span><span class='layout'>,</span> <span class='layout'>(</span><span class='varid'>desc</span><span class='layout'>,</span> <span class='keyword'>_</span><span class='layout'>,</span> <span class='keyword'>_</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>=</span>
<a name="(line18)"></a>  <span class='str'>"    "</span> <span class='varop'>++</span> <span class='varid'>toFunction</span> <span class='varid'>name</span>  <span class='varop'>++</span> <span class='str'>" :: "</span> <span class='varop'>++</span> 
<a name="(line19)"></a>  <span class='varid'>maybeColumnLabel</span> <span class='varid'>cd</span> <span class='varop'>++</span>
<a name="(line20)"></a>  <span class='varid'>getHaskellTypeString</span> <span class='layout'>(</span><span class='varid'>colType</span> <span class='varid'>desc</span><span class='layout'>)</span>
<a name="(line21)"></a>
<a name="(line22)"></a><a name="maybeColumnLabel"></a><span class='varid'>maybeColumnLabel</span> <span class='keyglyph'>::</span> <span class='layout'>(</span><span class='conid'>String</span><span class='layout'>,</span> <span class='layout'>(</span><span class='conid'>SqlColDesc</span><span class='layout'>,</span> <span class='conid'>ForeignKeyReferences</span><span class='layout'>,</span> <span class='conid'>HasDefault</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line23)"></a><span class='varid'>maybeColumnLabel</span> <span class='layout'>(</span><span class='keyword'>_</span><span class='layout'>,</span> <span class='layout'>(</span><span class='keyword'>_</span><span class='layout'>,</span> <span class='keyword'>_</span><span class='layout'>,</span> <span class='conid'>True</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='str'>"Maybe "</span>  <span class='comment'>-- Does the column have a default</span>
<a name="(line24)"></a><span class='varid'>maybeColumnLabel</span> <span class='layout'>(</span><span class='keyword'>_</span><span class='layout'>,</span> <span class='layout'>(</span><span class='varid'>desc</span><span class='layout'>,</span> <span class='keyword'>_</span><span class='layout'>,</span> <span class='keyword'>_</span><span class='layout'>)</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='keyword'>if</span> <span class='layout'>(</span><span class='layout'>(</span><span class='varid'>colNullable</span> <span class='varid'>desc</span><span class='layout'>)</span> <span class='varop'>==</span> <span class='conid'>Just</span> <span class='conid'>True</span><span class='layout'>)</span> <span class='keyword'>then</span> <span class='str'>"Maybe "</span> <span class='keyword'>else</span> <span class='str'>""</span>
<a name="(line25)"></a>
<a name="(line26)"></a><a name="getHaskellTypeString"></a><span class='comment'>-- Derived from hdbc-postgresql/Database/PostgreSQL/Statement.hs and hdbc/Database/HDBC/SqlValue.hs</span>
<a name="(line27)"></a><span class='varid'>getHaskellTypeString</span> <span class='keyglyph'>::</span> <span class='conid'>SqlTypeId</span> <span class='keyglyph'>-&gt;</span> <span class='conid'>String</span>
<a name="(line28)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line29)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlVarCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line30)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlLongVarCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line31)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlWCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line32)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlWVarCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line33)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlWLongVarCharT</span> <span class='keyglyph'>=</span> <span class='str'>"String"</span>
<a name="(line34)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlDecimalT</span> <span class='keyglyph'>=</span> <span class='str'>"Rational"</span>
<a name="(line35)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlNumericT</span> <span class='keyglyph'>=</span> <span class='str'>"Rational"</span>
<a name="(line36)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlTinyIntT</span> <span class='keyglyph'>=</span> <span class='str'>"Int32"</span>
<a name="(line37)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlSmallIntT</span> <span class='keyglyph'>=</span><span class='str'>"Int32"</span>
<a name="(line38)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlIntegerT</span> <span class='keyglyph'>=</span> <span class='str'>"Int32"</span>
<a name="(line39)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlBigIntT</span> <span class='keyglyph'>=</span> <span class='str'>"Integer"</span>
<a name="(line40)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlRealT</span> <span class='keyglyph'>=</span> <span class='str'>"Double"</span>
<a name="(line41)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlFloatT</span> <span class='keyglyph'>=</span> <span class='str'>"Double"</span>
<a name="(line42)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlDoubleT</span> <span class='keyglyph'>=</span> <span class='str'>"Double"</span>
<a name="(line43)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlBitT</span> <span class='keyglyph'>=</span> <span class='str'>"Bool"</span>
<a name="(line44)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlDateT</span> <span class='keyglyph'>=</span> <span class='str'>"Day"</span>
<a name="(line45)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlTimestampWithZoneT</span> <span class='keyglyph'>=</span> <span class='str'>"ZonedTime"</span>
<a name="(line46)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlTimestampT</span> <span class='keyglyph'>=</span> <span class='str'>"UTCTime"</span>
<a name="(line47)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlUTCDateTimeT</span> <span class='keyglyph'>=</span> <span class='str'>"UTCTime"</span>
<a name="(line48)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlTimeT</span> <span class='keyglyph'>=</span> <span class='str'>"TimeOfDay"</span>
<a name="(line49)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlUTCTimeT</span> <span class='keyglyph'>=</span> <span class='str'>"TimeOfDay"</span>
<a name="(line50)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlTimeWithZoneT</span> <span class='keyglyph'>=</span> <span class='varid'>error</span> <span class='str'>"Turbinado ORM Generator: SqlTimeWithZoneT is not supported"</span>
<a name="(line51)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlBinaryT</span> <span class='keyglyph'>=</span> <span class='str'>"B.ByteString"</span>
<a name="(line52)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlVarBinaryT</span> <span class='keyglyph'>=</span> <span class='str'>"B.ByteString"</span>
<a name="(line53)"></a><span class='varid'>getHaskellTypeString</span>    <span class='conid'>SqlLongVarBinaryT</span> <span class='keyglyph'>=</span> <span class='str'>"B.ByteString"</span>
<a name="(line54)"></a><span class='varid'>getHaskellTypeString</span>    <span class='varid'>t</span> <span class='keyglyph'>=</span> <span class='varid'>error</span> <span class='str'>"Turbinado ORM Generator: Don't know how to translate this SqlTypeId ("</span> <span class='varop'>++</span> <span class='varid'>show</span> <span class='varid'>t</span> <span class='varop'>++</span> <span class='str'>" to a Haskell Type"</span>
<a name="(line55)"></a>
<a name="(line56)"></a>
<a name="(line57)"></a><a name="toFunction"></a><span class='comment'>-- | Used for safety.  Lowercases the first letter to </span>
<a name="(line58)"></a><span class='comment'>-- make a valid function.</span>
<a name="(line59)"></a><span class='varid'>toFunction</span> <span class='conid'>[]</span> <span class='keyglyph'>=</span> <span class='varid'>error</span> <span class='str'>"toFunction passed an empty string"</span>
<a name="(line60)"></a><span class='varid'>toFunction</span> <span class='layout'>(</span><span class='varid'>firstLetter</span><span class='conop'>:</span><span class='varid'>letters</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Char</span><span class='varop'>.</span><span class='varid'>toLower</span> <span class='varid'>firstLetter</span><span class='layout'>)</span> <span class='conop'>:</span> <span class='varid'>letters</span>
<a name="(line61)"></a>
<a name="(line62)"></a>
<a name="(line63)"></a><a name="toType"></a><span class='comment'>-- | Used for safety.  Uppercases the first letter to </span>
<a name="(line64)"></a><span class='comment'>-- make a valid type.</span>
<a name="(line65)"></a><span class='varid'>toType</span> <span class='conid'>[]</span> <span class='keyglyph'>=</span> <span class='varid'>error</span> <span class='str'>"toType passed an empty string"</span>
<a name="(line66)"></a><span class='varid'>toType</span> <span class='layout'>(</span><span class='varid'>firstLetter</span><span class='conop'>:</span><span class='varid'>letters</span><span class='layout'>)</span> <span class='keyglyph'>=</span> <span class='layout'>(</span><span class='conid'>Data</span><span class='varop'>.</span><span class='conid'>Char</span><span class='varop'>.</span><span class='varid'>toUpper</span> <span class='varid'>firstLetter</span><span class='layout'>)</span> <span class='conop'>:</span> <span class='varid'>letters</span>
<a name="(line67)"></a>
</pre></body>
</html>
